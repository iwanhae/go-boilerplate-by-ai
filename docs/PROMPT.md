Read [oapi-codegen.md](oapi-codegen.md) and generate a **fully-functional** typical web API server boilerplate using **oapi-codegen** and **go-chi**.

The detailed requirements are as follows.

# Requirements

## Requirement 0. Implementation Scope

1. The boilerplate must fully implement the following APIs:
   - `GET /debug/metrics`: Expose a metrics endpoint that Prometheus can scrape.
   - `POST /debug/logs?level=debug`: Allow adjusting log verbosity at runtime without restarting the application. No response body is required, but the HTTP status code must indicate success.
   - `GET /debug/pprof/*`: Expose profiling endpoints via the `net/http/pprof` package.
   - **Blogging Resource API**: Provide a RESTful API for a blog platform:
     - `GET /posts`: Return a list of metadata for existing posts. Support cursor-based pagination.
     - `POST /posts`: Create a new text-based blog post.
     - `GET /posts/{id}`: Return metadata and content for a specific post.
     - `PUT /posts/{id}`: Update the content of a specific post.
     - `DELETE /posts/{id}`: Delete a specific post.

## Requirement 1. HTTP Handler

0. Use `oapi-codegen`’s **strict-server** mode.  
1. Generate server code with `go tool` + `oapi-codegen`.  
2. **Centralized error handling**: When business logic returns a predefined error, middleware must translate it into the appropriate HTTP error response.  
3. **Request ID**: Assign a unique Request ID to every request. All functions sharing the same `context.Context` must be able to access it, and it must also be returned to the client via an HTTP response header.  
4. **Logging**: Log basic information for each HTTP request and response. If business logic returns an error, log with debugging-focused details.  
5. **Request validation**: Perform full validation in the HTTP handler layer and return `400 Bad Request` before invoking business logic if validation fails.  
6. **Test code**: Ensure every middleware component maintains ≥ 80% test coverage.

## Requirement 2. Logging

1. Use **slog** for all logging.  
2. **Contextual logging**: Include the Request ID in all logs generated by functions sharing the HTTP request context.  
3. **Environment formats**: Log in plain text in development and JSON in production.

## Requirement 3. Configuration

1. Store all default configuration values in a `defaults.yaml` file.  
2. Embed `defaults.yaml` into the binary at build time using `//go:embed`.  
3. Allow overriding YAML-defined values via environment variables.  
4. **Test code**: Maintain ≥ 80% test coverage for this configuration logic.

## Requirement 4. Storage

1. Manage persistent data via this interface:

   ```go
   type Store interface {
       Set(key string, value any) error
       Get(key string) (value any, err error)
       List(keyPrefix string) (values []any, err error)
       Delete(key string) error
       Close() error
   }
   ```

For the boilerplate, provide an in-memory implementation using a map[string]any.

## Requirement 5. Graceful Shutdown

On receiving SIGTERM:

1. Wait 5 seconds.
2. Cancel the root context.
3. Gracefully close all resources.

## Requirement 6. Architecture

Follow Hexagonal Architecture principles.
Test code: Achieve ≥ 80% test coverage for all functions, except trivially simple ones.

# Workflow

The boilerplate development proceeds in the following order:

1. Draft the design that satisfies all requirements in `ARCHITECTURE.md`.
2. Review `ARCHITECTURE.md` to ensure it covers every requirement, then create `ARCHITECTUREv2.md`.
3. List the tasks needed to implement `ARCHITECTUREv2.md` in `CHECKLIST.md`.
4. Execute the tasks in `CHECKLIST.md`:
   1. Select a task in `CHECKLIST.md` and mark it as **WIP**.
   2. Update the code.
   3. IMPORTANT: Run `go test` and `go build` to verify all tests pass, test coverage meets the threshold, and the build succeeds.
   4. After all tests pass, build succeeds, and test coverage meets the threshold, mark the task in `CHECKLIST.md` as **Done**.
5. Once all tasks in `CHECKLIST.md` are completed, write `README.md` to finalize the project.

# FYI.

1. Init project with `go mod init gosuda.org/boilerplate`.
2. Before `go test`, run `go mod tidy` and `go fmt ./...` for correcting the code automatically.
3. When using `go test`, always explicitly set timeout for preventing the test from hanging.
4. Use `go build` for type checking.